# UI描画改善タスク

## 概要
現在のUI描画実装における問題点を解決し、仕様書のデザイン原則に準拠した統一されたレイアウトシステムを構築する。

## 問題点
1. **画面によって表示がブレる** - 表示ロジックが統一されていない
2. **グリッドレイアウトの未実装** - 仕様書の「グリッドレイアウトを意識し、要素を整然と配置」が満たされていない
3. **ボタンヒントの位置ずれ** - 物理ボタンの位置と合っていない

## 改善目標

### 1. グリッドレイアウトシステムの実装
- **画面を適切なサイズの正方形グリッドで分割**
- **各UI要素をグリッドセル内に配置**
- **例外**: タイトルバー/ステータスバー、ボタンヒントは文字高さに合わせた領域を確保し罫線を描画

### 2. 共通UI要素の統一
- **タイトルバー/ステータスバー**: 画面最上部、Font2、罫線付き
- **ボタンヒント**: 物理ボタン位置に正確配置、Font2、罫線付き、`A:`表記は不要

### 3. 表示ロジックの共通化
- 各画面の描画関数で共通UI要素の描画を統一
- スプライトの初期化・クリア・描画・反映の順序を統一

## 実装方針

### 1. グリッドシステムの定義
```cpp
// 画面サイズ
#define SCREEN_WIDTH 320
#define SCREEN_HEIGHT 240

// 共通UI要素の高さ
#define TITLE_HEIGHT 20 // タイトルバー高さ
#define HINT_HEIGHT 20  // ボタンヒント高さ

// コンテンツ領域（タイトルバーとボタンヒントを除いた部分）
#define CONTENT_WIDTH 320
#define CONTENT_HEIGHT 200  // 240 - 20 - 20

// グリッド定義（コンテンツ領域を8x5グリッドに分割）
#define GRID_WIDTH 40   // 320/8
#define GRID_HEIGHT 40  // 200/5

// グリッド座標からピクセル座標への変換ヘルパー
#define GRID_X(col) (col * GRID_WIDTH)
#define GRID_Y(row) (TITLE_HEIGHT + row * GRID_HEIGHT)
```

### 2. 共通UI描画関数の作成
```cpp
void drawCommonUI(const char* modeName);
void drawTitleBar(const char* modeName);
void drawButtonHints(const char* btnA, const char* btnB, const char* btnC);
void drawGridLines(); // グリッド線の描画（デバッグ用）
```

### 3. 各画面のレイアウト再設計
- **メイン画面**: グリッドセル(0,0)-(7,4)を使用（コンテンツ領域全体）
- **設定メニュー**: グリッドセル(1,1)-(6,3)を使用（中央寄せ）
- **スケジュール選択**: グリッドセル(0,1)-(7,3)を使用（幅いっぱい）
- **入力モード**: グリッドセル(1,1)-(6,3)を使用（中央寄せ）

## 具体的な作業手順

### Phase 1: グリッドシステム基盤の構築
1. `ui.h`にグリッド定義とヘルパー関数を追加
2. 共通UI描画関数を実装
3. 罫線描画機能を実装

### Phase 2: 各画面のレイアウト修正
1. `drawMainDisplay()`のグリッド配置修正
2. `drawSettingsMenu()`のグリッド配置修正
3. `drawScheduleSelect()`のグリッド配置修正
4. `drawInputMode()`のグリッド配置修正

### Phase 3: ボタンヒント位置の修正
1. 物理ボタン位置に合わせた座標計算
2. `A:`表記の削除
3. 罫線の追加

### Phase 4: 表示ロジックの統一
1. 各描画関数の構造を統一
2. スプライト操作の順序を統一
3. エラーハンドリングの追加

## 期待される成果
- **統一されたレイアウト**: 全画面で一貫したグリッドベースの配置
- **視認性の向上**: 罫線とグリッドによる整然とした表示
- **操作性の向上**: 正確なボタンヒント位置
- **保守性の向上**: 共通化されたUI描画ロジック

## 注意事項
- 既存の機能は維持する
- フォントサイズは仕様書通り（Font7/4/2）を使用
- 色定義は既存の`AMBER_COLOR`、`FLASH_ORANGE`等を使用
- パフォーマンスを考慮し、不要な再描画は避ける

## 完了基準
1. 全画面でグリッドレイアウトが適用されている
2. タイトルバーとボタンヒントに罫線が描画されている
3. ボタンヒントが物理ボタン位置と正確に合っている
4. 画面間で表示のブレが解消されている
5. 既存機能が正常に動作している 