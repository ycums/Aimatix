# M5Stack 集中タイマー 開発作業計画書

## プロジェクト概要
M5Stack Fire を使用し、アンバーCRT風UIの集中タイマーを開発する。Wi-Fi/NTPによる時刻同期、複数アラーム設定、設定の永続化、アラーム鳴動機能などを実装する。

## 現在の状況
- PlatformIOプロジェクトの基本設定完了。
- 必要なライブラリ（M5Stack, NTPClient, EEPROM, WiFi）を追加。
- `main.cpp`に基本的なプログラム構造、モード管理、設定の永続化（EEPROM）、Wi-Fi接続、NTP時刻同期、ステータスバー/ボタンヒント描画、メイン表示、アラーム鳴動、入力モード、設定メニュー、スケジュール選択モードの基本ロジックを実装。
- 最新のビルドエラーを修正済み。

## 今後の作業項目
以下の順序で作業を進める。

1.  **コードの分割と整理**
    - 現在`main.cpp`に集約されているコードを、機能ごとに`.h`および`.cpp`ファイルに分割する。
    - 例: `ui.h`/`ui.cpp` (描画関連), `settings.h`/`settings.cpp` (設定管理), `alarm.h`/`alarm.cpp` (アラーム管理), `input.h`/`input.cpp` (入力処理) など。
    - 各ファイルでクラスや構造体を適切に利用し、コードの見通しと保守性を向上させる。

2.  **未実装機能・詳細ロジックの実装**
    - 各モードの詳細な描画処理（特にプログレスバーの正確な計算・描画、リスト表示のスクロールなど）。
    - 入力モードでの数字入力、桁送り、確定、キャンセルの完全なロジック実装。
    - スケジュール選択モードでの項目選択、削除、SETTINGSへの遷移ロジックの完成。
    - アラーム鳴動時のバイブレーション制御（M5Stack Fireのピン確認と制御コード）。
    - SmartConfigによるWi-Fi設定の実装。
    - エラーハンドリング（Wi-Fi接続失敗時の再試行・表示、NTP同期失敗時の処理など）。
    - ディープスリープモードの実装検討（一定時間アイドル後）。
    - INFO画面でのバージョン、著作権、MACアドレス表示の実装。

3.  **Unit Test の作成**
    - PlatformIOのテストフレームワークを利用し、主要なロジック（時刻計算、設定管理、入力処理など）のUnit Testを作成する。

4.  **実機での動作確認とデバッグ**
    - 各機能が実装されるごとに、M5Stack Fire実機に書き込んで動作確認を行う。
    - シリアルモニタなどを活用し、デバッグを行う。

5.  **コードレビューとリファクタリング**
    - 全体を通してコードの品質向上、効率化、可読性向上を行う。

## マイルストーン
- マイルストーン1: 基本構造の実装とビルド成功 (達成)
- マイルストーン2: コードの分割と主要機能の骨子実装
- マイルストーン3: 全機能の実装とUnit Testの作成
- マイルストーン4: 実機での総合テストと最終調整

## 完了基準
- 仕様書に記載された全ての機能が実装されていること。
- 実機で安定して動作すること。
- 主要なロジックに対するUnit Testが存在すること。
- コードが適切に構造化され、可読性が高いこと。
