# M5Stack集中タイマー 実装作業計画書

## 1. 目的
M5Stack Fire用集中タイマーの仕様（task01.prompt.md）を満たすよう、現状ソースコードを修正・拡張する。

## 2. 主な作業項目

### 2.1 Wi-Fi設定のSmartConfig対応とPreferences保存
- SmartConfigでSSID/パスワード取得、Preferencesに保存・読込
- 起動時にPreferencesからWi-Fi情報を取得し自動接続

### 2.2 NTP同期後のWi-Fi自動OFF
- NTP同期完了後にWi-FiをOFFにする処理を追加

### 2.3 設定値のPreferences永続化
- EEPROM利用部分をPreferencesに置換
- SOUND/LCD BRIGHTNESSの保存・読込

### 2.4 INFOサブメニューの追加
- ファームウェアバージョン、MACアドレス等の表示画面を追加

### 2.5 音の制御仕様準拠
- 0.5秒ON/OFF×5回の制御を厳密に実装（音のみ）

### 2.6 進捗バーの仕様準拠
- 直前の解除時刻～次の鳴動時刻までを100%とした進捗計算・色分け

### 2.7 アラームリストの最大5件制御
- UI/ロジックで5件超の追加を禁止

### 2.8 ユニットテストの追加
- 各ロジックのテストコードを`test/`配下に作成

### 2.9 エラーハンドリング強化
- Wi-Fi/NTP/設定保存失敗時の画面表示

### 2.10 ディープスリープ等の電源管理
- 一定時間アイドル時にディープスリープへ移行

## 3. 作業手順
1. 本計画書の作成（このファイル）
2. 必要な修正・追加ファイルのリストアップ
3. 各項目ごとに設計・実装・テスト
4. ユーザー確認ポイントでビルド・動作確認
5. 仕様を満たすまで繰り返し修正

## 4. ユーザー確認ポイント
- Wi-Fi/SmartConfig動作
- NTP同期・時刻表示
- 各モードの画面遷移・UI
- アラーム鳴動・解除
- 設定保存・反映
- INFO画面表示
- 進捗バー・リスト制御
- 電源管理

---

この計画に沿って順次作業を進めます。
