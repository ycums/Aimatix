# 【質問票】3-0-9: 入力画面で桁送りができる（InputLogic/UIの編集操作拡張）実装前確認

本質問票は「3-0-9: 入力画面で桁送りができる（InputLogic/UIの編集操作拡張）」の実装に先立ち、仕様・要件・テスト基準の明確化と合意を目的としています。

---

## 1. 仕様・要件の確認

### 1-1. B短押し時の動作仕様
- [x] B短押しで「桁送り」移動するのは正しいですか？
    - [x] はい
    - [ ] いいえ（【自由記述】）
- [x] 桁送りの方向は？
    - [x] 右から左（3→2→1→0）
    - [ ] 左から右（0→1→2→3→0）
    - [ ] その他（【自由記述】）
- [ ] 桁送り時の音・フィードバックは？
    - [x] 音なし
    - [ ] 効果音あり
    - [ ] その他（【自由記述】）

### 1-2. 桁送りの制約
- [ ] 全桁入力済み（99:99）の状態でB短押しした場合の挙動は？
    - [x] 桁送り拒絶（移動しない）
    - [ ] 通常通り移動
    - [ ] その他（【自由記述】）
- [ ] 部分入力状態での桁送りは？
    - [x] 入力済み桁のみ移動可能
    - [ ] 未入力桁も移動可能
    - [ ] その他（【自由記述】）

### 1-3. 桁送りの具体例
- [ ] 以下の具体例は正しいですか？
    - [x] `__:_1` の状態でB短押し → `__:1_`
    - [x] `__:1_` の状態でB短押し → `_1:0_`
    - [x] `__:12` の状態でB短押し → `_1:2_`
    - [x] `__:99` の状態でB短押し → `_9:9_`
    - [x] `99:99` の状態でB短押し → 拒絶
    - [ ] その他（【自由記述】）

### 1-5. UI反映・コマンド/イベント駆動
- [ ] 桁送り時、どのようなコマンド/イベントを発行し、どの画面・状態に反映させますか？
    - 【自由記述】
      - 桁送り成功なら、入力済みの値を左にシフト (桁送り)
      - 桁送り失敗なら、何もしない（音・視覚的フィードバックなし）

---

## 2. UI・表示仕様

### 2-2. 桁送り時のUI反応
- [ ] 桁送り成功時のUI表示・フィードバックは？
    - [ ] ハイライト位置の即座切り替えのみ
    - [ ] 効果音/バイブ
    - [x] その他（【自由記述】）
      - [ ] 特になし。
- [x] 桁送り失敗時のUI表示・フィードバックは？
    - [x] 何もしない（音・視覚的フィードバックなし）
    - [ ] エラーメッセージ
    - [ ] その他（【自由記述】）

### 2-3. ボタンヒントの表示
- [x] 入力画面のボタンヒント表示は？
    - [x] A: "INC" B: "NEXT" C: "SET"（Amber CRTテーマ統一）
    - [ ] その他（【自由記述】）

---

## 3. テスト・完成条件

### 3-1. 完成判定
- [ ] 以下の条件を満たせば「完成」としてよいですか？
    - [x] 入力画面B短押しで桁送りが正しく動作する
    - [x] 桁送りの制約（全桁入力済み時の拒絶）が仕様通り
    - [x] カーソル位置の視覚的フィードバックが正しく表示される
    - [x] InputLogicのUnit Testが追加されている
    - [x] カバレッジが品質ゲートを上回っている
    - [x] UI/デザインが仕様に沿っている
    - [x] 入力画面の各ボタンヒントに対応する挙動が正しく動作すること
    - [ ] その他（【自由記述】）

### 3-2. テスト観点
- [ ] テストで特に重視すべき観点・パターンがあればご記入ください
    - 【自由記述】
      - 未入力状態での桁送り 
        - `__:__` なら 何もおこらない
        - `__:_1` なら `__:1_`
      - 未入力状態での確定拒絶
      - B長押しでの入力値リセット (`__:__`)
      - 全桁入力済み状態での移動拒絶
      - 境界値テスト（各桁の入力状態）

## 5. その他・ご要望
- [ ] その他、実装・UI・テストに関するご要望・注意点があればご記入ください
    - MUST: 設計は `doc/design/` に準拠させること
    - MUST: 仕様は `doc/spec/` に準拠させること
    - SHOULD: 進行に関しては `guide/developer_guide.md` を参照のこと
    - SHOULD: 可能な限りTDDで進めること
    - 【自由記述】
    - 桁送りは純粋ロジックとして実装し、UI依存を避けること
    - 既存のInputLogicの設計（digits/entered/cursor）を活用すること

---

## 【仕様転記】
過去の質問票（3-0-8）から転記：

### エラーメッセージの言語
- エラー時に表示するメッセージは英語にすること。
  - 実機に日本語フォントが導入されていないため。

### 設計原則
- 純粋ロジック（InputLogic）はUI遷移や画面制御を一切持たず、値の検証・変換のみを担当する。
- UI層は「桁送り」イベントを受けて、ロジック層APIを呼び出し、戻り値やイベント通知をもとにUI反映を行う。
- 必要に応じて、APIの戻り値として「成否」「エラー内容」等を構造体やenumで返す。

### テスト方針
- 可能な限りTDDで進めること
- テストは `pio test -e native` で実行すること
- カバレッジは品質ゲートを上回ること 