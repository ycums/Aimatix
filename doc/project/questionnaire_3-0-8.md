# 【質問票】3-0-8: 入力画面C短押しでアラーム追加 実装前確認

本質問票は「3-0-8: 入力画面C短押しでアラーム追加（AlarmLogicのaddAlarm実装、内部状態コミット・画面反映の背骨完成）」の実装に先立ち、仕様・要件・テスト基準の明確化と合意を目的としています。

---

## 1. 仕様・要件の確認

### 1-1. C短押し時の動作仕様
- [ ] C短押しで「入力値」をアラームとして追加するのは正しいですか？
    - [x] はい
    - [ ] いいえ（【自由記述】）
- [ ] 入力値が「__:__」など未入力の場合、アラーム追加はどうなりますか？
    - [x] 追加不可（エラー表示）
    - [ ] 00:00等で追加
    - [ ] その他（【自由記述】）
- [ ] 追加後の画面遷移は？
    - [ ] 入力画面のまま
    - [x] メイン画面に戻る
    - [ ] アラーム管理画面に遷移
    - [ ] その他（【自由記述】）

### 1-2. アラーム追加の制約
- [ ] アラームの最大登録数（5件）を超えた場合の挙動は？
    - [x] 追加不可（エラー表示）
    - [ ] 最古のアラームを削除して追加
    - [ ] その他（【自由記述】）
- [ ] 同一時刻のアラームは追加できますか？
    - [x] 不可（重複拒否）
    - [ ] 可
    - [ ] その他（【自由記述】）
- [ ] 過去時刻（現在時刻より前）は追加できますか？
    - [ ] 不可（エラー表示）
    - [x] 翌日のアラームとして追加
    - [ ] その他（【自由記述】）

### 1-3. AlarmLogic::addAlarmの仕様
- [ ] addAlarmの戻り値（bool）は「追加成功/失敗」を示す仕様でよいですか？
    - [x] はい
    - [ ] いいえ（【自由記述】）
- [ ] 失敗時の理由（重複・上限・不正値等）はどのようにUIへ通知しますか？
    - [ ] 戻り値のみ
    - [x] エラーコード/メッセージも返す
      - この開発ステップでは blink や beep でもOK.
    - [ ] その他（【自由記述】）

### 1-4. コマンド/イベント駆動・画面反映
- [ ] アラーム追加時、どのようなコマンド/イベントを発行し、どの画面・状態に反映させますか？
    - 【自由記述】
      - 追加成功なら、メイン画面へ遷移
      - 追加失敗なら、エラー表示ないし、blinkやbeep出して拒否。
- [ ] 他画面（メイン画面・アラーム管理画面等）への反映タイミング・方法は？
    - [ ] 即時反映
    - [ ] 次回遷移時に反映
    - [x] その他（【自由記述】）
      - 即時遷移して反映

### 1-5. AlarmDisplay雛形
- [ ] 今回のステップでAlarmDisplay（アラーム一覧画面）はどの程度stub実装しますか？
    - [ ] 画面遷移のみ
    - [ ] リスト表示の枠のみ
    - [ ] アラーム時刻のダミー表示
    - [x] その他（【自由記述】）
      - 不要。この開発ステップの要件から削除。

---

## 2. UI・表示仕様

### 2-1. アラーム追加時のUI反応
- [ ] 追加成功時のUI表示・フィードバックは？
    - [ ] メッセージ表示
    - [ ] 効果音/バイブ
    - [x] 画面遷移のみ
    - [ ] その他（【自由記述】）
- [ ] 追加失敗時のUI表示・フィードバックは？
    - [x] エラーメッセージ
    - [x] 効果音/バイブ
    - [ ] その他（【自由記述】）
      - 実装が一番楽なものでヨシ。

### 2-2. アラーム一覧の表示仕様（AlarmDisplay）
- [ ] アラームリストの並び順は？
    - [ ] 時刻順
      - 左が一番現在時刻に近く、右が一番未来。
    - [ ] 追加順
    - [x] その他（【自由記述】）
      - 不要。この開発ステップの要件から削除。
- [ ] 最大何件まで表示しますか？
    - [ ] 5件
    - [x] その他（【自由記述】）
      - 不要。この開発ステップの要件から削除。

---

## 3. テスト・完成条件

### 3-1. 完成判定
- [ ] 以下の条件を満たせば「完成」としてよいですか？
    - [x] 入力画面C短押しでアラームが追加できる
    - [x] 入力画面C長押しで入力をキャンセルしてメイン場面へ戻れること
    - [x] アラーム追加の制約（重複・上限・不正値）が仕様通り
    - [x] 追加結果が画面/UIに正しく反映される
    - [ ] AlarmLogicのUnit Testが追加されている
    - [x] カバレッジが品質ゲートを上回っている
    - [x] UI/デザインが仕様に沿っている
    - [ ] その他（【自由記述】）

### 3-2. テスト観点
- [ ] テストで特に重視すべき観点・パターンがあればご記入ください
    - 【自由記述】

---

## 4. その他・ご要望
- [ ] その他、実装・UI・テストに関するご要望・注意点があればご記入ください
    - MUST: 設計は `doc/design/` に準拠させること
    - MUST: 仕様は `doc/spec/` に準拠させること
    - SHOULD: 進行に関しては `guide/developer_guide.md` を参照のこと
    - SHOULD: 可能な限りTDDで進めること
    - 【自由記述】 
    - エラー時に表示するメッセージは英語にすること。
      - 実機に日本語フォントが導入されていないため。

---

## 【仕様修正】
アラーム追加時の不正値（例: 99:99, 15:99, 9:90 など）はエラーではなく、spec.mdの通り「最も近い未来の正しい時刻」に補正して追加する。
過去時刻も「一番近い未来の正しい時刻」に補正して追加する。
重複・上限超過・未入力はエラー。
この仕様に従い、テスト・UI・エラー通知も設計すること。